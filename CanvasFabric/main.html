<html>

<head>
<title>Drawing</title>
<style>
canvas
{
    border-style: solid;
}
</style>
</head>


			
<link rel="stylesheet" href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-js/1.4.0/css/fabric.min.css" />
<link rel="stylesheet" href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-js/1.4.0/css/fabric.components.min.css" />
<script src="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-js/1.4.0/js/fabric.min.js"></script>

		


<body>
<button class="ms-Button">
    <span class="Button-label">Select</span> 
</button>
<button class="ms-Button">
    <span class="Button-label">Rectangle</span> 
</button>
<button class="ms-Button">
    <span class="Button-label">Circle</span> 
</button>
<button class="ms-Button">
    <span class="Button-label">Line</span> 
</button>
<button class="ms-Button">
    <span class="Button-label">Triangle</span> 
</button>
<button class="ms-Button">
    <span class="Button-label">Text</span> 
</button>            
<button class="ms-Button">
    <span class="Button-label">Free Draw</span> 
</button>   
<button class="ms-Button">
    <span class="Button-label">Delete</span> 
</button>  
<button class="ms-Button">
    <span class="Button-label">Change Color</span> 
</button>  
<button class="ms-Button">
    <span class="Button-label">Undo</span> 
</button>
<input type="color" value="#000000">
<canvas id="myCanvas" width="600" height="500"></canvas>



<script src="fabric.js"></script>
<script>


var canvas = new fabric.Canvas('myCanvas', {
                isDrawingMode: false
});

canvas.setDimensions({width:window.innerWidth*0.9, height:window.innerHeight*0.8});

//flowchart?
//text option

var Mouse = {
    x: 0,
    y: 0,
    tool: "default",
    state: false    //true is clicking, false is not
}
var Global = {
    color: "black",
    creating: false, //flag for object creation
    anchor: {x:0,y:0},
    selectedObjectCreate: null
}
var state = []; //Saves
state.push(canvas.toDatalessJSON());

function rectangle(x,y)
{

    if (Global.selectedObjectCreate == null)
    {
        Global.anchor.x = x;
        Global.anchor.y = y;
        Global.selectedObjectCreate = new fabric.Rect({
        left: x,
        top: y,
        fill: Global.color,
        width: 0,
        angle: 0,
        height: 0,
        objectCaching: false
        });
        canvas.add(Global.selectedObjectCreate);
    }
    else
    {
        Global.selectedObjectCreate.set({"width": x - Global.anchor.x, "height": y - Global.anchor.y});
        canvas.renderAll();
        Global.selectedObjectCreate.setCoords();
    }



}
function ellipse(x,y)
{
    if (Global.selectedObjectCreate == null)
    {
        Global.anchor.x = x;
        Global.anchor.y = y;
        Global.selectedObjectCreate = new fabric.Circle({
        left: x,
        top: y,
        originX: "center",
        originY: "center",
        fill: Global.color,
        radius: 0,
        objectCaching: false
        });
        canvas.add(Global.selectedObjectCreate);
    }
    else
    {
        Global.selectedObjectCreate.set({"top":y,"left":x,"radius": Math.abs(x-Global.anchor.x)});
        canvas.renderAll();
        Global.selectedObjectCreate.setCoords();
    }
}
function line(x, y)
{

    if (Global.selectedObjectCreate == null)
    {
        Global.anchor.x = x;
        Global.anchor.y = y;
        Global.selectedObjectCreate = new fabric.Line([x, y, Global.anchor.x, Global.anchor.y],{
        strokeWidth: 2,
        stroke: Global.color,
        objectCaching: false
    });
    canvas.add(Global.selectedObjectCreate);
    }
    else
    {
        Global.selectedObjectCreate.set({"y2":y,"x2":x});
        canvas.renderAll();
        Global.selectedObjectCreate.setCoords();
    }

    
    
}
function triangle(x,y)
{
    if (Global.selectedObjectCreate == null)
    {
        Global.anchor.x = x;
        Global.anchor.y = y;
        Global.selectedObjectCreate = new fabric.Triangle({
        left: x,
        top: y,
        fill: Global.color,
        width: 0,
        height: 0,
        objectCaching: false
        });
        canvas.add(Global.selectedObjectCreate);
    }
    else
    {
        Global.selectedObjectCreate.set({"width": x - Global.anchor.x, "height": y - Global.anchor.y});
        canvas.renderAll();
        Global.selectedObjectCreate.setCoords();
    }
    
}
function text(x, y)
{

    Global.selectedObjectCreate = new fabric.Text('Text', { 
    fontFamily: 'Delicious_500', 
    left: x, 
    top: y 
    });
    canvas.ActiveSelection
    canvas.add(Global.selectedObjectCreate);

}

function create(type)
{
    canvas.isDrawingMode = false;
    canvas.selection = false;
    switch(type)
    {
        case "default":
            canvas.selection = true;
        break;
        case "rectangle":
            rectangle(Mouse.x,Mouse.y);
        break;
        case "ellipse":
            ellipse(Mouse.x,Mouse.y);
        break;
        case "line":
            line(Mouse.x,Mouse.y);
        break;
        case "triangle":
            triangle(Mouse.x,Mouse.y);
        break;
        case "text":
            text(Mouse.x,Mouse.y);
        break;
        case "freeDraw":
            canvas.isDrawingMode = true;
        break;
        case "delete":
            console.log(canvas.getActiveObject());
            canvas.requestRenderAll();
        break;
    }
}

var ButtonElements = document.querySelectorAll(".ms-Button");

new fabric['Button'](ButtonElements[0], function() {
    Mouse.tool = "default";
    canvas.selection = true;
    canvas.isDrawingMode = false;
});
new fabric['Button'](ButtonElements[1], function() {
      Mouse.tool = "rectangle";
});
new fabric['Button'](ButtonElements[2], function() {
      Mouse.tool = "ellipse";
});
new fabric['Button'](ButtonElements[3], function() {
      Mouse.tool = "line";
});
new fabric['Button'](ButtonElements[4], function() {
      Mouse.tool = "triangle";
});
new fabric['Button'](ButtonElements[5], function() {
      Mouse.tool = "text";
});
new fabric['Button'](ButtonElements[6], function() {
    Mouse.tool = "freeDraw";
    canvas.selection = false;
    canvas.isDrawingMode = true;
});
new fabric['Button'](ButtonElements[7], function() {
    Mouse.tool = "delete";
    canvas.getActiveObjects().forEach((obj) => {
    canvas.remove(obj)
    });
    canvas.discardActiveObject().renderAll();
      
});
new fabric['Button'](ButtonElements[8], function() {
    Mouse.tool = "changeColor";
    canvas.getActiveObjects().forEach((obj) => {
    obj.fill = Global.color;
    });
    if (canvas.getActiveObject()!= null)
        canvas.getActiveObject().set("fill", Global.color);
    
    canvas.discardActiveObject().renderAll();
      
});
new fabric['Button'](ButtonElements[9], function() {
    //Undo
    canvas.loadFromJSON(state[state.length-2], function()
    {
        state.pop();
    })
});

canvas.on('mouse:down', function(options) {
  
    Mouse.state = true;
    if (canvas.getActiveObject() == null)
    {
        Global.creating = true;
        create(Mouse.tool);
    }
    else
    {
        Mouse.tool = "default";
    }
    

    state.push(canvas.toDatalessJSON());
    
});
canvas.on('mouse:up', function(options) {
    
    Mouse.state = false;
    Global.selectedObjectCreate = null;
});
canvas.on('mouse:move', function(options) {
  
    Mouse.x = options.e.layerX;
    Mouse.y = options.e.layerY;
    if (Mouse.state == true)
    {
        if (Global.selectedObjectCreate != null)
        {
            if (Mouse.tool == "line")
            {
                line(Mouse.x, Mouse.y);
            }
            if (Mouse.tool == "rectangle")
            {
                rectangle(Mouse.x, Mouse.y);
            }
            if (Mouse.tool == "ellipse")
            {
                ellipse(Mouse.x, Mouse.y);
            }
            if (Mouse.tool == "triangle")
            {
                triangle(Mouse.x, Mouse.y);
            }
        }        
    }
});
document.addEventListener("change", watchColorPicker, false);
document.addEventListener("input", watchColorPicker, false);
function watchColorPicker(event) {
    Global.color = event.target.value;
    canvas.getActiveObjects().forEach((obj) => {
    obj.fill = Global.color;
    obj.stroke = Global.color;
    });
    canvas.requestRenderAll();
    
}
document.addEventListener('keydown', function(event) { 
            const key = event.key; 
            if (key === "Delete") { 
                canvas.getActiveObjects().forEach((obj) => {
                canvas.remove(obj)
                });
                canvas.discardActiveObject().renderAll();
            } 
            else
            {
                if (canvas.getActiveObject() != null)
                {
                    if (key == "Backspace")
                    {
                        canvas.getActiveObject().text = "";
                        canvas.requestRenderAll();
                    }
                    else
                    {
                        canvas.getActiveObject().text += key;
                        canvas.requestRenderAll();
                    }
                }
            }

        }); 
</script>

</body>
</html>